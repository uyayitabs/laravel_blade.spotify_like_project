!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(jQuery)}((function(e){function t(e,t,a){var i=window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI;e.style.width=e.style.width||e.width+"px",e.style.height=e.style.height||e.height+"px";var o=document.getElementById("wave-form-container");e.width=Math.ceil(o.offsetWidth*i),e.height=Math.ceil(o.offsetHeight*i),e.style.width=e.width/i+"px",e.style.height=e.height/i+"px";var n=e.getContext("2d");a&&(n.fillStyle=a);for(var r=e.width,d=e.height,l=.4/i,s=3*i,u=s+Math.max(i,~~(s/2)),c=t.length/r,m=d/2,g=.5*d||0,h=0;h<r;h+=u){var p=Math.round(t[Math.floor(h*c)]/1*m*1.1);n.fillRect(h+l,m-p+g,s+l,2*p)}}function a(e,t,a){scaleFactor=window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,e.style.width=e.style.width||e.width+"px",e.style.height=e.style.height||e.height+"px",e.width=Math.ceil(e.width*scaleFactor),e.height=Math.ceil(e.height*scaleFactor);var i=e.getContext("2d");a&&(i.fillStyle=a);for(var o=e.width,n=e.height,r=t.length/o,d=n/2,l=.5*n||0,s=Math.ceil(t.length/o),u=0;u<o;u++){for(var c=1,m=-1,g=0;g<s;g++){var h=t[u*s+g];h<c&&(c=h),h>m&&(m=h)}var p=Math.round(t[Math.floor(u*r)]/1*d);i.fillRect(u,d-p+l,1,2*p)}}e(document).ready((function(){e("#embed_bottom_player, .draggable").disableSelection()})),window.PageSwiper={init:function(){setTimeout((function(){var t=[];e(".swiper-container-channel").each((function(a,i){var o=e(this).parents(".home-section").find(".swiper-arrow-left"),n=e(this).parents(".home-section").find(".swiper-arrow-right");t[a]=new Swiper(i,{slidesPerView:"auto",paginationClickable:!0,spaceBetween:0,watchSlidesProgress:!0,watchSlidesVisibility:!0,loop:e.engineUtils.isMobile(),simulateTouch:!1,slidesPerGroup:2,navigation:{nextEl:n,prevEl:o}})}));new Swiper(".swiper-container-slide",{slidesPerView:"auto",paginationClickable:!0,spaceBetween:0,watchSlidesProgress:!0,watchSlidesVisibility:!0,loop:e.engineUtils.isMobile(),simulateTouch:!1,slidesPerGroup:1,navigation:{nextEl:e(".swiper-container-slide").parents(".home-section").find(".swiper-arrow-right"),prevEl:e(".swiper-container-slide").parents(".home-section").find(".swiper-arrow-left")}})}),500)}},e(window).on("enginePageHasBeenLoaded",PageSwiper.init),window.DragQueue={loaded:!1,item:null,init:function(){e.engineUtils.isMobile()||(e("#embed_list_middle").sortable({scroll:!1,placeholder:"queue-sortable-placeholder",helper:function(t,a){var i=e("<div />");return i.addClass("sortable-queue-helper"),i},appendTo:"#embed_bottom_player",revert:200,cursorAt:{top:0,left:0},start:function(t,a){if(2===e("#embed_list_container li").length||e(".queue-droppable-placeholder").addClass("hide"),e("body").addClass("lock-childs"),a.item.show(),!e(".sortable-queue-helper").hasClass("ui-draggable-dragging")){var i=e(a.item).attr("position"),o=EMBED.Playlist[i];__DEV__&&console.log("Sorting",o),e(a.helper).html(o.title)}var n=e("<div />");n.attr("id","queueSortableTextHelper"),n.html("drop here"),e("body").append(n)},change:function(t,a){e("#embed_list_middle .queue-sortable-placeholder *").remove(),e("#queueSortableTextHelper").css({bottom:e("#embed_list_middle").height()+24,left:e("#embed_list_middle .queue-sortable-placeholder").offset().left-32})},update:function(t,a){var i=a.item.attr("position"),o=a.item.index();i?(e(a.helper).remove(),e("[id=queueSortableTextHelper]").remove(),EMBED.List.move(i,o),parseInt(i)===parseInt(EMBED.Player.queueNumber)&&(EMBED.Player.queueNumber=o),e("#embed_list_middle li").each((function(t){e(this).attr("position",t),e(this).find(".embed_current_playlist_play_button").attr("id","embed_current_playlist_play_button_"+t),EMBED.PlaylistObj.obj[e(this).attr("id").replace("embed_current_playlist_row_","")].position=t}))):(e(a.item).remove(),setTimeout((function(){DragQueue.objectDropped(DragQueue.item,o-1)}),100)),console.log(i,o,EMBED.Player.queueNumber),EMBED.Event.fire(window,"embedQueueChanged")},receive:function(e,t){DragQueue.item=t.item},stop:function(t,a){e("[id=queueSortableTextHelper]").remove(),setTimeout((function(){e("body").removeClass("lock-childs")}),200),1===EMBED.Playlist.length&&EMBED.Player.playAt(0)}}),e(".draggable").draggable({appendTo:"body",zIndex:2e3,scroll:!1,connectToSortable:"#embed_list_middle",helper:function(){e("#embed_bottom_player").addClass("embed_no_transition");var t=e("<li />");return t.addClass("sortable-queue-helper"),t.css({width:"auto",height:"auto"}),t},cursorAt:{top:0,left:0},revert:"invalid",start:function(t,a){if(EMBED.List.show(),e(".queue-droppable-placeholder").length)e(".queue-droppable-placeholder").removeClass("hide");else{var i=e("<div />");i.addClass("queue-droppable-placeholder");var o=e("<div />");o.html(Language.text.ADD_TO_QUEUE),i.append(o);var n=e("<div />");n.html(Language.text.DROP_HERE),i.append(n),e("#embed_list_container").append(i)}e("body").addClass("lock-childs");var r=e(t.target).data("type"),d=e(t.target).data("id"),l=window[r+"_data_"+d];__DEV__&&console.log("dragging",r,l),e(a.helper).css("width","auto"),"artist"===r||"user"===r?e(a.helper).html(l.name):e(a.helper).html(l.title)},update:function(t,a){e(".queue-droppable-placeholder").addClass("hide"),e(a.helper).remove()},stop:function(t,a){setTimeout((function(){e("body").removeClass("lock-childs")}),200),e("[id=queueSortableTextHelper]").remove(),e(".queue-droppable-placeholder").addClass("hide"),EMBED.Playlist.length||EMBED.List.hide()}}),e("#embed_list_middle").droppable({drop:function(e,t){DragQueue.objectDropped(t.draggable,0,!0)}}),DragQueue.loaded=!0)},objectDropped:function(t,a,i){i=void 0!==i&&i;var o=t.data("type"),n=t.data("id"),r=window[o+"_data_"+n],d=document.getElementById("embed_list_middle");if("song"===o){if(EMBED.Playlist.length){var l=hex_md5(EMBED.Playlist[EMBED.Player.queueNumber].stream_url);EMBED.PlaylistObj.addSongAtPosition([e.engineUtils.toPlayerJson(r)],a),EMBED.Player.queueNumber=EMBED.PlaylistObj.obj[l].position}else EMBED.PlaylistObj.addSongAtPosition([e.engineUtils.toPlayerJson(r)],a);setTimeout((function(){EMBED.List.renderSongs(d),Toast.show("queue",Language.text.POPUP_QUEUE_SONG_ADDED.replace(":numSongs",1)),i&&EMBED.Player.playAt(a)}),200)}else"station"===o?Playlist.playLiveRadioStation([e.engineUtils.stationToPlayerJson(r)],!0):"user"===o?(Toast.show("success",Language.text.PLEASE_WAIT),e.ajax({type:"get",url:route.route("api.user.recent",{id:n}),success:function(e){if(e&&e.songs&&e.songs.data.length){if(EMBED.Playlist.length){var t=hex_md5(EMBED.Playlist[EMBED.Player.queueNumber].stream_url);EMBED.PlaylistObj.addSongAtPosition(e.songs.data,a),EMBED.Player.queueNumber=EMBED.PlaylistObj.obj[t].position,EMBED.Player.queueNumber=EMBED.PlaylistObj.obj[t].position}else EMBED.PlaylistObj.addSongAtPosition(e.songs.data,a);EMBED.List.renderSongs(d),Toast.show("queue",1===e.songs.data.length?Language.text.POPUP_QUEUE_SONG_ADDED.replace(":numSongs",e.songs.data.length):Language.text.POPUP_QUEUE_SONGS_ADDED.replace(":numSongs",e.songs.data.length)),i&&EMBED.Player.playAt(a)}}})):(Toast.show("success",Language.text.PLEASE_WAIT),e.ajax({type:"get",url:route.route("api."+o,{id:n}),success:function(e){if(e&&e.songs&&e.songs.length){if(EMBED.Playlist.length){var t=hex_md5(EMBED.Playlist[EMBED.Player.queueNumber].stream_url);EMBED.PlaylistObj.addSongAtPosition(e.songs,a),EMBED.Player.queueNumber=EMBED.PlaylistObj.obj[t].position,EMBED.Player.queueNumber=EMBED.PlaylistObj.obj[t].position}else EMBED.PlaylistObj.addSongAtPosition(e.songs,a);EMBED.List.renderSongs(d),Toast.show("queue",1===e.songs.length?Language.text.POPUP_QUEUE_SONG_ADDED.replace(":numSongs",e.songs.length):Language.text.POPUP_QUEUE_SONGS_ADDED.replace(":numSongs",e.songs.length)),i&&EMBED.Player.playAt(a)}}}));e("#embed_list_middle").droppable("disable")}},e(window).on("embedPlayerLoaded",DragQueue.init),e(window).on("enginePageHasBeenLoaded",DragQueue.init),e(window).ready((function(){e.engineUtils.isMobile()||EMBED.Event.add(window,"embedQueueChanged",(function(){setTimeout((function(){EMBED.Playlist.length?(e("#embed_list_middle").droppable("disable"),e("#embed_list_middle").sortable("enable")):(e("#embed_list_middle").droppable("enable"),e("#embed_list_middle").sortable("disable"))}))}))})),window.LoadingIndicator={init:function(t){e("body").scrollTop(0);var a=window.location.href.toString().split(window.location.host)[1];(a=a.split("/")[1])?"radio"===a?LoadingIndicator.show("loading-radio"):"artist"===a||"playlist"===a||"album"===a||"song"===a?LoadingIndicator.show("loading-profile-card"):"trending"===a?LoadingIndicator.show("loading-trending"):"community"===a?LoadingIndicator.show("loading-community"):"discover"===a?LoadingIndicator.show("loading-discover"):LoadingIndicator.show("loading-other"):LoadingIndicator.show("loading-radio")},show:function(t){e(window).scrollTop(0),e("#page").html(tmpl(t))}},e(window).on("engineHistoryChange",LoadingIndicator.init),window.Navigator={url:null,init:function(t){Navigator.url=t;var a=e("#page h1:first").html(),i=window.location.href.toString().split(window.location.host)[1];i=i.split("/")[1],console.log(t.url),console.log(window.location.pathname),i?(a&&e("#header-nav-title").html(a),e("#header-nav-logo").addClass("hide")):(e("#header-nav-title").html(""),e("#header-nav-logo").removeClass("hide"))},click:function(){var t=window.location.href.toString().split(window.location.host)[1];if(!(t=t.split("/")[1]))return e.engineSideBar.show(),!1;window.history.back()},icon:function(t){var a=e("#header-nav-btn");"/"===window.location.pathname?(a.find(".menu").removeClass("hide"),a.find(".back").addClass("hide")):(a.find(".menu").addClass("hide"),a.find(".back").removeClass("hide"))}},e(window).on("engineHistoryChange",Navigator.icon),e(document).ready(Navigator.icon),e("#header-nav-btn").bind("click",Navigator.click),e(window).on("enginePageHasBeenLoaded",Navigator.icon),window.Favicon={done:!1,state:null,percentage:0,isRetina:function(){return window.devicePixelRatio>1},icon:{play:{normal:route.route("frontend.homepage")+"common/images/play-favicon.png",retina:route.route("frontend.homepage")+"common/images/play-favicon@2x.png"},pause:{normal:route.route("frontend.homepage")+"common/images/pause-favicon.png",retina:route.route("frontend.homepage")+"common/images/pause-favicon@2x.png"}},watch:function(){return!e.engineUtils.isMobile()&&(!Favicon.done&&(EMBED.Player.Audio.addEventListener("play",Favicon.setPlay,!1),EMBED.Player.Audio.addEventListener("pause",Favicon.setPause,!1),EMBED.Player.Audio.addEventListener("timeupdate",Favicon.onTimeUpdate,!1),void(Favicon.done=!0)))},setPlay:function(){Favicon.state="play",Favicon.update()},setPause:function(){Favicon.state="pause",Favicon.update()},onTimeUpdate:function(){var e=(this.currentTime/this.duration).toFixed(2);Favicon.percentage!==e&&(Favicon.percentage=e,Favicon.update())},update:function(){var e=document.getElementById("favicon"),t=Favicon.isRetina()?32:16,a=document.createElement("canvas");a.width=t,a.height=t;var i=a.getContext("2d"),o=document.createElement("img");"play"===Favicon.state?o.src=Favicon.isRetina()?Favicon.icon.play.retina:Favicon.icon.play.normal:"pause"===Favicon.state&&(o.src=Favicon.isRetina()?Favicon.icon.pause.retina:Favicon.icon.pause.normal);var n=Favicon.isRetina()?2:1,r=Favicon.isRetina()?1:2,d=Favicon.percentage;o.onload=function(){i.drawImage(o,0,0,16/r,16/r,4*n,4*n,8*n,8*n),i.beginPath(),i.moveTo(16*n-1,8*n),i.arc(8*n,8*n,7*n,0,2*Math.PI,!1),i.lineWidth=2*n,i.strokeStyle="rgba(120, 120, 120, 0.2)",i.stroke(),i.beginPath(),i.moveTo(8*n,n),i.arc(8*n,8*n,7*n,.5*-Math.PI,Math.PI*(2*d-.5),!1),i.lineWidth=2*n,i.strokeStyle="rgba(226, 47, 53, 1)",i.stroke(),i.beginPath(),i.moveTo(8*n,2.5*n),i.arc(8*n,8*n,5.5*n,.5*-Math.PI,Math.PI*(2*d-.5),!1),i.lineWidth=n,i.strokeStyle="rgb(226, 47, 53, 0.3)",i.stroke(),e.href=a.toDataURL("image/png")}}},e(document).ready((function(){EMBED.Event.add(window,"embedPlayerLoaded",(function(){Favicon.watch()})),EMBED.Event.add(window,"embedQueueChanged",(function(){setTimeout((function(){if(!EMBED.Playlist.length)return!1;var e=EMBED.Playlist[EMBED.Player.queueNumber];document.title=e.title+" - "+e.artists.map((function(e){return e.name})).join(", ")}),500)}))}));var i={audioContext:null,data:null,make:function(){null!==i.audioContext&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,i.audioContext=new window.AudioContext);var o=e(".track-waveform").width();if(e("canvas").attr("width",o),e(".track-waveform").attr("data-uri")){var n;window.AudioContext=window.AudioContext||window.webkitAudioContext,n=new AudioContext;var r=new XMLHttpRequest;r.open("GET",e(".track-waveform").attr("data-uri"),!0),r.responseType="arraybuffer",r.onload=function(){n.decodeAudioData(r.response,(function(o){var n=function(e,t){for(var a=t.length/e,i=~~(a/10)||1,o=t.numberOfChannels,n=[],r=[],d=0;d<o;d++)for(var l=n[d]=[],s=t.getChannelData(d),u=0;u<e;u++){for(var c=~~(u*a),m=~~(c+a),g=0,h=0,p=c;p<m;p+=i){var f=s[p];f>h&&(h=f),f<g&&(g=f)}l[2*u]=h,l[2*u+1]=g,(0===d||h>r[2*u])&&(r[2*u]=h),(0===d||g<r[2*u+1])&&(r[2*u+1]=g)}return r}(1024,o);i.data=n,e(".track-waveform").hasClass("wave")?(a(document.getElementById("waveform"),n,document.body.classList.contains("dark-theme")?"#fff":"#000"),a(document.getElementById("waveform-active-"+e("#wave-form-container").attr("data-id")),n,"#e23036")):(t(document.getElementById("waveform"),n,document.body.classList.contains("dark-theme")?"#fff":"#000"),t(document.getElementById("waveform-active-"+e("#wave-form-container").attr("data-id")),n,"#e23036")),e.ajax({method:"POST",url:route.route("frontend.waveform.save",{id:e("waveform").data("id")}),data:{perk:JSON.stringify(n)},success:function(e){__DEV__&&console.log("Created and saved waveform perk data.")}})}),(function(e){console.error("decodeAudioData error",e)}))},r.send()}else e.ajax({method:"GET",url:route.route("frontend.waveform.get",{id:e("waveform").data("id")}),success:function(o){o=JSON.parse(o),i.data=o,e("waveform").length&&(e(".track-waveform").hasClass("wave")?(a(document.getElementById("waveform"),o,document.body.classList.contains("dark-theme")?"#fff":"#000"),a(document.getElementById("waveform-active-"+e("#wave-form-container").attr("data-id")),o,"#e23036")):(t(document.getElementById("waveform"),o,document.body.classList.contains("dark-theme")?"#fff":"#000"),t(document.getElementById("waveform-active-"+e("#wave-form-container").attr("data-id")),o,"#e23036")))}})},reRender:function(){try{if(null===i.data)return!1;e(".track-waveform").hasClass("wave")?(a(document.getElementById("waveform"),i.data,document.body.classList.contains("dark-theme")?"#fff":"#000"),a(document.getElementById("waveform-active-"+e("#wave-form-container").attr("data-id")),i.data,"#e23036")):(t(document.getElementById("waveform"),i.data,document.body.classList.contains("dark-theme")?"#fff":"#000"),t(document.getElementById("waveform-active-"+e("#wave-form-container").attr("data-id")),i.data,"#e23036"))}catch(e){}}};window.addEventListener("resize",(function(e){i.reRender()})),e(window).bind("enginePageHasBeenLoaded",(function(){if(e("#wave-form-container").length&&i.make(e("#wave-form-container")),EMBED.Playlist.length&&!e.engineUtils.isMobile())EMBED.Playlist[EMBED.Player.queueNumber]})),e(document).ready((function(){EMBED.Event.add(window,"embedQueueChanged",(function(){setTimeout((function(){if(EMBED.Playlist.length&&!e.engineUtils.isMobile())EMBED.Playlist[EMBED.Player.queueNumber]}),1e3)})),EMBED.Event.add(window,"embedVisualizerStarted",(function(){e("#waveform, waveform").remove()})),EMBED.Event.add(window,"embedPlayerLoaded",(function(){EMBED.Player.Audio.addEventListener("timeupdate",(function(){var t=EMBED.Playlist[EMBED.Player.queueNumber];if(t.id&&e("#waveform-active-"+t.id).length)try{var a=EMBED.Utils.mmss(Math.floor(this.currentTime));e(".player-time:first").html(a);var i=EMBED.Utils.mmss(Math.floor(this.duration));e(".player-time.end-time span").html(i);var o=this.currentTime/this.duration,n=e(".track-waveform").width();e("waveform").css("width",o*n)}catch(e){}}),!1)}))}))}));
